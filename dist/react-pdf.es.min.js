import t from"fs";import e from"blob-stream";import i from"react-reconciler";import r,{PDFFont as o}from"@react-pdf/pdfkit";import{Fragment as s}from"react";import n from"yoga-layout-prebuilt";import a from"lodash.pick";import h from"lodash.merge";import l from"lodash.topairsin";import d from"lodash.isfunction";import c from"media-engine";import p from"@textkit/pdf-renderer";import u from"is-url";import g from"@react-pdf/fontkit";import f from"cross-fetch";import{LayoutEngine as m,Attachment as y,AttributedString as b,Rect as T,Path as w,Container as E}from"@react-pdf/textkit-core";import C from"@react-pdf/script-itemizer";import v from"@textkit/justification-engine";import x from"@textkit/text-decoration-engine";import R from"emoji-regex";import S from"url";import P from"path";import L from"jpegasus";import A from"blob-to-buffer";import B from"to-arraybuffer";import M from"@react-pdf/png-js";import k from"page-wrapping";const O=t=>t.charAt(0).toUpperCase()+t.slice(1),D=t=>{const e=(t=>/((-)?\d+\.?\d*)%/g.exec(t))(t);if(e){const t=parseFloat(e[1],10),i=t/100;return{value:t,percent:i,absValue:Math.abs(t),absPercent:Math.abs(i)}}return null};class W{constructor(){this.parent=null,this.children=[],this.computed=!1,this.layout=n.Node.createDefault()}appendChild(t){t&&(t.parent=this,this.children.push(t),this.layout.insertChild(t.layout,this.layout.getChildCount()))}appendChildBefore(t,e){const i=this.children.indexOf(e);-1!==i&&t&&(t.parent=this,this.children.splice(i,0,t),this.layout.insertChild(t.layout,i))}removeChild(t){const e=this.children.indexOf(t);-1!==e&&(t.parent=null,this.children.splice(e,1),this.layout.removeChild(t.layout))}removeAllChilds(){const t=[...this.children];for(let e=0;e<t.length;e++)t[e].remove()}remove(){this.parent.removeChild(this)}setDimension(t,e){const i=`set${O(t)}`,r=`${i}Percent`,o=D(e);o?this.layout[r](o.value):this.layout[i](e)}setPosition(t,e){const i=D(e);i?this.layout.setPositionPercent(t,i.value):this.layout.setPosition(t,e)}setPadding(t,e){const i=D(e);i?this.layout.setPaddingPercent(t,i.value):this.layout.setPadding(t,e)}setMargin(t,e){const i=D(e);i?this.layout.setMarginPercent(t,i.value):this.layout.setMargin(t,e)}setBorder(t,e){if(D(e))throw new Error("Node: You cannot set percentage border widths");this.layout.setBorder(t,e)}getAbsoluteLayout(){const t=this.parent,e=t&&t.getAbsoluteLayout?t.getAbsoluteLayout():{left:0,top:0};return{left:this.left+e.left,top:this.top+e.top,height:this.height,width:this.width}}copyStyle(t){this.layout.copyStyle(t.layout)}calculateLayout(){this.layout.calculateLayout(),this.computed=!0}isEmpty(){return 0===this.children.length}markDirty(){return this.layout.markDirty()}onAppendDynamically(){}get position(){return this.layout.getPositionType()===n.POSITION_TYPE_ABSOLUTE?"absolute":"relative"}get top(){return this.layout.getComputedTop()||0}get left(){return this.layout.getComputedLeft()||0}get right(){return this.layout.getComputedRight()||0}get bottom(){return this.layout.getComputedBottom()||0}get width(){return this.layout.getComputedWidth()}get minWidth(){return this.layout.getMinWidth().value}get maxWidth(){return this.layout.getMaxWidth().value}get height(){return this.layout.getComputedHeight()}get minHeight(){return this.layout.getMinHeight().value}get maxHeight(){return this.layout.getMaxHeight().value}get paddingTop(){return this.layout.getComputedPadding(n.EDGE_TOP)||0}get paddingRight(){return this.layout.getComputedPadding(n.EDGE_RIGHT)||0}get paddingBottom(){return this.layout.getComputedPadding(n.EDGE_BOTTOM)||0}get paddingLeft(){return this.layout.getComputedPadding(n.EDGE_LEFT)||0}get marginTop(){return this.layout.getComputedMargin(n.EDGE_TOP)||0}get marginRight(){return this.layout.getComputedMargin(n.EDGE_RIGHT)||0}get marginBottom(){return this.layout.getComputedMargin(n.EDGE_BOTTOM)||0}get marginLeft(){return this.layout.getComputedMargin(n.EDGE_LEFT)||0}get borderTopWidth(){return this.layout.getComputedBorder(n.EDGE_TOP)||0}get borderRightWidth(){return this.layout.getComputedBorder(n.EDGE_RIGHT)||0}get borderBottomWidth(){return this.layout.getComputedBorder(n.EDGE_BOTTOM)||0}get borderLeftWidth(){return this.layout.getComputedBorder(n.EDGE_LEFT)||0}get padding(){return{top:this.paddingTop,right:this.paddingRight,bottom:this.paddingBottom,left:this.paddingLeft}}get margin(){return{top:this.marginTop,right:this.marginRight,bottom:this.marginBottom,left:this.marginLeft}}set position(t){this.layout.setPositionType("absolute"===t?n.POSITION_TYPE_ABSOLUTE:n.POSITION_TYPE_RELATIVE)}set top(t){this.setPosition(n.EDGE_TOP,t)}set left(t){this.setPosition(n.EDGE_LEFT,t)}set right(t){this.setPosition(n.EDGE_RIGHT,t)}set bottom(t){this.setPosition(n.EDGE_BOTTOM,t)}set width(t){this.setDimension("width",t)}set minWidth(t){this.setDimension("minWidth",t)}set maxWidth(t){this.setDimension("maxWidth",t)}set height(t){this.setDimension("height",t)}set minHeight(t){this.setDimension("minHeight",t)}set maxHeight(t){this.setDimension("maxHeight",t)}set paddingTop(t){this.setPadding(n.EDGE_TOP,t)}set paddingRight(t){this.setPadding(n.EDGE_RIGHT,t)}set paddingBottom(t){this.setPadding(n.EDGE_BOTTOM,t)}set paddingLeft(t){this.setPadding(n.EDGE_LEFT,t)}set marginTop(t){this.setMargin(n.EDGE_TOP,t)}set marginRight(t){this.setMargin(n.EDGE_RIGHT,t)}set marginBottom(t){this.setMargin(n.EDGE_BOTTOM,t)}set marginLeft(t){this.setMargin(n.EDGE_LEFT,t)}set padding(t){this.paddingTop=t,this.paddingRight=t,this.paddingBottom=t,this.paddingLeft=t}set margin(t){this.marginTop=t,this.marginRight=t,this.marginBottom=t,this.marginLeft=t}set borderTopWidth(t){this.setBorder(n.EDGE_TOP,t)}set borderRightWidth(t){this.setBorder(n.EDGE_RIGHT,t)}set borderBottomWidth(t){this.setBorder(n.EDGE_BOTTOM,t)}set borderLeftWidth(t){this.setBorder(n.EDGE_LEFT,t)}}const I=(t,e)=>{const i=t=>"alignItems"===t||"alignContent"===t||"alignSelf"===t;switch(e){case"auto":if("alignSelf"===t)return n.ALIGN_AUTO;break;case"flex":return n.DISPLAY_FLEX;case"none":return n.DISPLAY_NONE;case"row":return n.FLEX_DIRECTION_ROW;case"row-reverse":return n.FLEX_DIRECTION_ROW_REVERSE;case"column":return n.FLEX_DIRECTION_COLUMN;case"column-reverse":return n.FLEX_DIRECTION_COLUMN_REVERSE;case"stretch":return n.ALIGN_STRETCH;case"baseline":return n.ALIGN_BASELINE;case"space-around":if("justifyContent"===t)return n.JUSTIFY_SPACE_AROUND;if(i(t))return n.ALIGN_SPACE_AROUND;break;case"space-between":if("justifyContent"===t)return n.JUSTIFY_SPACE_BETWEEN;if(i(t))return n.ALIGN_SPACE_BETWEEN;break;case"around":return n.JUSTIFY_SPACE_AROUND;case"between":return n.JUSTIFY_SPACE_BETWEEN;case"wrap":return n.WRAP_WRAP;case"wrap-reverse":return n.WRAP_WRAP_REVERSE;case"nowrap":return n.WRAP_NO_WRAP;case"flex-start":if("justifyContent"===t)return n.JUSTIFY_FLEX_START;if(i(t))return n.ALIGN_FLEX_START;break;case"flex-end":if("justifyContent"===t)return n.JUSTIFY_FLEX_END;if(i(t))return n.ALIGN_FLEX_END;break;case"center":if("justifyContent"===t)return n.JUSTIFY_CENTER;if(i(t))return n.ALIGN_CENTER;break;default:return e}},_=t=>{let e={};const i=(t=>{const e=/^(-?\d*\.?\d+)(in|mm|cm|pt)?$/g.exec(t);return e?{value:parseFloat(e[1],10),unit:e[2]||"pt"}:{value:t,unit:void 0}})(t);switch(i.unit){case"in":e=72*i.value;break;case"mm":e=i.value*(1/25.4)*72;break;case"cm":e=i.value*(1/2.54)*72;break;default:e=i.value}return e},z=(t,e)=>t.match(/^border/)&&"string"==typeof e,F=(t,e)=>{const i=(t=>t.match(/(\d+(px|in|mm|cm|pt)?)\s(\S+)\s(\S+)/))(e);if(i){if(t.match(/.Color/))return i[4];if(t.match(/.Style/))return i[3];if(t.match(/.Width/))return i[1];throw new Error(`StyleSheet: Invalid '${e}' for '${t}'`)}return e},G=(t,e)=>t.match(/^(margin)|(padding)/)&&"string"==typeof e,N=(t,e)=>{const i=(t=>t.match(/\d+(px|in|mm|cm|pt|%)?/g))(e);if(i){if(t.match(/.Top/))return i[0];if(t.match(/.Right/))return i[1]||i[0];if(t.match(/.Bottom/))return i[2]||i[0];if(t.match(/.Left/))return i[3]||i[1]||i[0];throw new Error(`StyleSheet: Invalid '${e}' for '${t}'`)}return e},j={thin:100,hairline:100,ultralight:200,extralight:200,light:300,normal:400,medium:500,semibold:600,demibold:600,bold:700,ultrabold:800,extrabold:800,heavy:900,black:900},H=t=>t.match(/^fontWeight/),U=t=>t?"number"==typeof t?t:j[t.toLowerCase()]:j.normal,V=(t,e)=>t.match(/^objectPosition/)&&"string"==typeof e,X=(t,e)=>{const i=(t=>t.match(/\d+(px|in|mm|cm|pt|%)?/g))(e);if(i){if(t.match(/.X/))return i[0];if(t.match(/.Y/))return i[1];throw new Error(`StyleSheet: Invalid '${e}' for '${t}'`)}return e},$=(t,e)=>t.match(/^transformOrigin/)&&"string"==typeof e,Y=(t,e)=>{const i=(t=>t.match(/(-?\d+(px|in|mm|cm|pt|%)?)|top|right|bottom|left|center/g))(e);if(i){let r;if(t.match(/.X/))r=i[0];else{if(!t.match(/.Y/))throw new Error(`StyleSheet: Invalid '${e}' for '${t}'`);r=i[1]||i[0]}return(t=>{switch(t){case"top":case"left":return"0%";case"right":case"bottom":return"100%";case"center":return"50%";default:return t}})(r)}return e},J=Object.prototype.hasOwnProperty,q={margin:{marginTop:!0,marginRight:!0,marginBottom:!0,marginLeft:!0},marginHorizontal:{marginLeft:!0,marginRight:!0},marginVertical:{marginTop:!0,marginBottom:!0},padding:{paddingTop:!0,paddingRight:!0,paddingBottom:!0,paddingLeft:!0},paddingHorizontal:{paddingLeft:!0,paddingRight:!0},paddingVertical:{paddingTop:!0,paddingBottom:!0},border:{borderTopColor:!0,borderTopStyle:!0,borderTopWidth:!0,borderRightColor:!0,borderRightStyle:!0,borderRightWidth:!0,borderBottomColor:!0,borderBottomStyle:!0,borderBottomWidth:!0,borderLeftColor:!0,borderLeftStyle:!0,borderLeftWidth:!0},borderTop:{borderTopColor:!0,borderTopStyle:!0,borderTopWidth:!0},borderRight:{borderRightColor:!0,borderRightStyle:!0,borderRightWidth:!0},borderBottom:{borderBottomColor:!0,borderBottomStyle:!0,borderBottomWidth:!0},borderLeft:{borderLeftColor:!0,borderLeftStyle:!0,borderLeftWidth:!0},borderColor:{borderTopColor:!0,borderRightColor:!0,borderBottomColor:!0,borderLeftColor:!0},borderRadius:{borderTopLeftRadius:!0,borderTopRightRadius:!0,borderBottomRightRadius:!0,borderBottomLeftRadius:!0},borderStyle:{borderTopStyle:!0,borderRightStyle:!0,borderBottomStyle:!0,borderLeftStyle:!0},borderWidth:{borderTopWidth:!0,borderRightWidth:!0,borderBottomWidth:!0,borderLeftWidth:!0},objectPosition:{objectPositionX:!0,objectPositionY:!0},transformOrigin:{transformOriginX:!0,transformOriginY:!0}},K=t=>{const e=(t=>{if(!t)return t;const e=Object.keys(t),i={};for(let r=0;r<e.length;r++){const o=e[r],s=t[o];switch(o){case"display":case"flex":case"flexDirection":case"flexWrap":case"flexFlow":case"flexGrow":case"flexShrink":case"flexBasis":case"justifyContent":case"alignSelf":case"alignItems":case"alignContent":case"order":i[o]=I(o,s);break;case"textAlignVertical":i.verticalAlign="center"===s?"middle":s;break;case"margin":case"marginHorizontal":case"marginVertical":case"padding":case"paddingHorizontal":case"paddingVertical":case"border":case"borderTop":case"borderRight":case"borderBottom":case"borderLeft":case"borderColor":case"borderRadius":case"borderStyle":case"borderWidth":case"objectPosition":case"transformOrigin":{const t=q[o];for(const e in t)J.call(t,e)&&(i[e]=s)}break;default:i[o]=s}}return i})(t),i=Object.keys(e),r={};for(let t=0;t<i.length;t++){const o=i[t],s=e[o];let n;n=z(o,s)?F(o,s):G(o,s)?N(o,s):V(o,s)?X(o,s):$(o,s)?Y(o,s):H(o)?U(s):s,r[o]=_(n)}return r},Z=t=>{return Array.isArray(t)||(t=[t]),t.reduce((t,e)=>{if(e){const i=Array.isArray(e)?Z(e):e;Object.keys(i).forEach(e=>{null!==i[e]&&void 0!==i[e]&&(t[e]=i[e])})}return t},{})};var Q={hairlineWidth:1,create:t=>t,resolve:(t,e)=>t?(t=((t,e)=>Object.keys(t).reduce((i,r)=>/@media/.test(r)?{...i,...c({[r]:t[r]},e)}:{...i,[r]:t[r]},{}))(t=Z(t),e),t=K(t)):null,flatten:Z,absoluteFillObject:{position:"absolute",top:0,left:0,bottom:0,right:0}};const tt={debug(){const t=this.getAbsoluteLayout(),e=this.padding,i=this.margin;this.root.instance.save(),this.debugContent(t,i,e),this.debugPadding(t,i,e),this.debugMargin(t,i),this.debugText(t,i),this.debugOrigin(),this.root.instance.restore()},debugOrigin(){if(this.style.transform){const t=this.origin;this.root.instance.circle(t[0],t[1],3).fill("red").circle(t[0],t[1],5).stroke("red")}},debugText(t,e){const i=Math.round(this.width+e.left+e.right),r=Math.round(this.height+e.top+e.bottom);this.root.instance.fontSize(4).opacity(1).fillColor("black").text(`${i} x ${r}`,t.left-e.left,Math.max(t.top-e.top-4,1))},debugContent(t,e,i){this.root.instance.fillColor("#a1c6e7").opacity(.5).rect(t.left+i.left,t.top+i.top,t.width-i.left-i.right,t.height-i.top-i.bottom).fill()},debugPadding(t,e,i){this.root.instance.fillColor("#c4deb9").opacity(.5),this.root.instance.rect(t.left+i.left,t.top,t.width-i.right-i.left,i.top).fill(),this.root.instance.rect(t.left,t.top,i.left,t.height).fill(),this.root.instance.rect(t.left+t.width-i.right,t.top,i.right,t.height).fill(),this.root.instance.rect(t.left+i.left,t.top+t.height-i.bottom,t.width-i.right-i.left,i.bottom).fill()},debugMargin(t,e){this.root.instance.fillColor("#f8cca1").opacity(.5),this.root.instance.rect(t.left,t.top-e.top,t.width,e.top).fill(),this.root.instance.rect(t.left-e.left,t.top-e.top,e.left,t.height+e.top+e.bottom).fill(),this.root.instance.rect(t.left+t.width,t.top-e.top,e.right,t.height+e.top+e.bottom).fill(),this.root.instance.rect(t.left,t.top+t.height,t.width,e.bottom).fill()}},et=(Math.sqrt(2)-1)/3*4;const it=(t,e,i,r,o)=>{const{top:s,left:n,width:a,height:h}=e,{borderTopWidth:l,borderRightWidth:d,borderLeftWidth:c}=i;t.moveTo(n+o,s),t.lineTo(n+a-r,s);const p=r*(1-et);t.bezierCurveTo(n+a-p,s,n+a,s+p,n+a,s+r);const u=s+Math.max(l,r);t.lineTo(n+a,u),t.lineTo(n+a-d,u);const g=Math.max(r-d,0),f=Math.max(r-l,0),m=g*(1-et),y=f*(1-et);t.bezierCurveTo(n+a-d,s+l+y,n+a-d-m,s+l,n+a-d-g,s+l),t.lineTo(n+Math.max(o,c),s+l);const b=Math.max(o-c,0),T=Math.max(o-l,0),w=b*(1-et),E=T*(1-et),C=s+Math.max(l,o);t.bezierCurveTo(n+c+w,s+l,n+c,s+l+E,n+c,C),t.lineTo(n,C),t.lineTo(n,s+o);const v=o*(1-et);if(t.bezierCurveTo(n,s+v,n+v,s,n+o,s),t.closePath(),t.clip(),d){const e=-l/d;t.moveTo(n+a/2,e*(-a/2)+s),t.lineTo(n+a,s),t.lineTo(n,s),t.lineTo(n,s+h),t.closePath(),t.clip()}if(c){const e=-l/c;t.moveTo(n+a/2,e*(-a/2)+s),t.lineTo(n,s),t.lineTo(n+a,s),t.lineTo(n+a,s+h),t.closePath(),t.clip()}},rt=(t,e,i,r,o)=>{const{top:s,left:n,width:a}=e,{borderTopColor:h,borderTopWidth:l,borderTopStyle:d,borderRightWidth:c,borderLeftWidth:p}=i,u=o*(1-et),g=r*(1-et);t.moveTo(n,s+Math.max(o,l)),t.bezierCurveTo(n,s+u,n+u,s,n+o,s),t.lineTo(n+a-r,s),t.bezierCurveTo(n+a-g,s,n+a,s+g,n+a,s+r),t.strokeColor(h),t.lineWidth(2*Math.max(c,l,p)),"dashed"===d?t.dash(2*l,{space:1.2*l}):"dotted"===d&&t.dash(l,{space:1.2*l}),t.stroke(),t.undash()},ot=(t,e,i,r,o)=>{const{top:s,left:n,width:a,height:h}=e,{borderTopWidth:l,borderRightWidth:d,borderBottomWidth:c}=i;t.moveTo(n+a,s+r),t.lineTo(n+a,s+h-o);const p=o*(1-et);t.bezierCurveTo(n+a,s+h-p,n+a-p,s+h,n+a-o,s+h);const u=n+a-Math.max(d,o);t.lineTo(u,s+h),t.lineTo(u,s+h-c);const g=Math.max(o-d,0),f=Math.max(o-c,0),m=g*(1-et),y=f*(1-et);t.bezierCurveTo(n+a-d-m,s+h-c,n+a-d,s+h-c-y,n+a-d,s+h-Math.max(o,c)),t.lineTo(n+a-d,s+Math.max(r,l));const b=Math.max(r-d,0),T=Math.max(r-l,0),w=b*(1-et),E=T*(1-et),C=n+a-Math.max(r,d);t.bezierCurveTo(n+a-d,s+l+E,n+a-d-w,s+l,C,s+l),t.lineTo(C,s),t.lineTo(n+a-r,s);const v=r*(1-et);if(t.bezierCurveTo(n+a-v,s,n+a,s+v,n+a,s+r),t.closePath(),t.clip(),l){const e=-l/d;t.moveTo(n+a/2,e*(-a/2)+s),t.lineTo(n+a,s),t.lineTo(n+a,s+h),t.lineTo(n,s+h),t.closePath(),t.clip()}if(c){const e=c/d;t.moveTo(n+a/2,e*(-a/2)+s+h),t.lineTo(n+a,s+h),t.lineTo(n+a,s),t.lineTo(n,s),t.closePath(),t.clip()}},st=(t,e,i,r,o)=>{const{top:s,left:n,width:a,height:h}=e,{borderRightColor:l,borderRightStyle:d,borderRightWidth:c,borderTopWidth:p,borderBottomWidth:u}=i,g=o*(1-et),f=r*(1-et);t.moveTo(n+a-r,s),t.bezierCurveTo(n+a-f,s,n+a,s+f,n+a,s+r),t.lineTo(n+a,s+h-o),t.bezierCurveTo(n+a,s+h-g,n+a-g,s+h,n+a-o,s+h),t.strokeColor(l),t.lineWidth(2*Math.max(c,p,u)),"dashed"===d?t.dash(2*c,{space:1.2*c}):"dotted"===d&&t.dash(c,{space:1.2*c}),t.stroke(),t.undash()},nt=(t,e,i,r,o)=>{const{top:s,left:n,width:a,height:h}=e,{borderBottomWidth:l,borderRightWidth:d,borderLeftWidth:c}=i;t.moveTo(n+a-o,s+h),t.lineTo(n+r,s+h);const p=r*(1-et);t.bezierCurveTo(n+p,s+h,n,s+h-p,n,s+h-r);const u=s+h-Math.max(l,r);t.lineTo(n,u),t.lineTo(n+c,u);const g=Math.max(r-c,0),f=Math.max(r-l,0),m=g*(1-et),y=f*(1-et);t.bezierCurveTo(n+c,s+h-l-y,n+c+m,s+h-l,n+c+g,s+h-l),t.lineTo(n+a-Math.max(o,d),s+h-l);const b=Math.max(o-d,0),T=Math.max(o-l,0),w=b*(1-et),E=T*(1-et),C=s+h-Math.max(l,o);t.bezierCurveTo(n+a-d-w,s+h-l,n+a-d,s+h-l-E,n+a-d,C),t.lineTo(n+a,C),t.lineTo(n+a,s+h-o);const v=o*(1-et);if(t.bezierCurveTo(n+a,s+h-v,n+a-v,s+h,n+a-o,s+h),t.closePath(),t.clip(),d){const e=l/d;t.moveTo(n+a/2,e*(-a/2)+s+h),t.lineTo(n+a,s+h),t.lineTo(n,s+h),t.lineTo(n,s),t.closePath(),t.clip()}if(c){const e=-l/c;t.moveTo(n+a/2,e*(a/2)+s+h),t.lineTo(n,s+h),t.lineTo(n+a,s+h),t.lineTo(n+a,s),t.closePath(),t.clip()}},at=(t,e,i,r,o)=>{const{top:s,left:n,width:a,height:h}=e,{borderBottomColor:l,borderBottomStyle:d,borderBottomWidth:c,borderRightWidth:p,borderLeftWidth:u}=i,g=r*(1-et),f=o*(1-et);t.moveTo(n+a,s+h-o),t.bezierCurveTo(n+a,s+h-f,n+a-f,s+h,n+a-o,s+h),t.lineTo(n+r,s+h),t.bezierCurveTo(n+g,s+h,n,s+h-g,n,s+h-r),t.strokeColor(l),t.lineWidth(2*Math.max(c,p,u)),"dashed"===d?t.dash(2*c,{space:1.2*c}):"dotted"===d&&t.dash(c,{space:1.2*c}),t.stroke(),t.undash()},ht=(t,e,i,r,o)=>{const{top:s,left:n,width:a,height:h}=e,{borderTopWidth:l,borderLeftWidth:d,borderBottomWidth:c}=i;t.moveTo(n,s+h-r),t.lineTo(n,s+o);const p=o*(1-et);t.bezierCurveTo(n,s+p,n+p,s,n+o,s);const u=n+Math.max(d,o);t.lineTo(u,s),t.lineTo(u,s+l);const g=Math.max(o-d,0),f=Math.max(o-l,0),m=g*(1-et),y=f*(1-et);t.bezierCurveTo(n+d+m,s+l,n+d,s+l+y,n+d,s+Math.max(o,l)),t.lineTo(n+d,s+h-Math.max(r,c));const b=Math.max(r-d,0),T=Math.max(r-c,0),w=b*(1-et),E=T*(1-et),C=n+Math.max(r,d);t.bezierCurveTo(n+d,s+h-c-E,n+d+w,s+h-c,C,s+h-c),t.lineTo(C,s+h),t.lineTo(n+r,s+h);const v=r*(1-et);if(t.bezierCurveTo(n+v,s+h,n,s+h-v,n,s+h-r),t.closePath(),t.clip(),c){const e=-c/d;t.moveTo(n+a/2,e*(a/2)+s+h),t.lineTo(n,s+h),t.lineTo(n,s),t.lineTo(n+a,s),t.closePath(),t.clip()}if(c){const e=-l/d;t.moveTo(n+a/2,e*(-a/2)+s),t.lineTo(n,s),t.lineTo(n,s+h),t.lineTo(n+a,s+h),t.closePath(),t.clip()}},lt=(t,e,i,r,o)=>{const{top:s,left:n,height:a}=e,{borderLeftColor:h,borderLeftStyle:l,borderLeftWidth:d,borderTopWidth:c,borderBottomWidth:p}=i,u=r*(1-et),g=o*(1-et);t.moveTo(n+r,s+a),t.bezierCurveTo(n+u,s+a,n,s+a-u,n,s+a-r),t.lineTo(n,s+o),t.bezierCurveTo(n,s+g,n+g,s,n+o,s),t.strokeColor(h),t.lineWidth(2*Math.max(d,c,p)),"dashed"===l?t.dash(2*d,{space:1.2*d}):"dotted"===l&&t.dash(d,{space:1.2*d}),t.stroke(),t.undash()};var dt={drawBorders:function(){const{instance:t}=this.root,e=this.getAbsoluteLayout(),{borderTopWidth:i,borderLeftWidth:r,borderRightWidth:o,borderBottomWidth:s}=this,{opacity:n,borderTopLeftRadius:a=0,borderTopRightRadius:h=0,borderBottomLeftRadius:l=0,borderBottomRightRadius:d=0,borderTopColor:c="black",borderTopStyle:p="solid",borderLeftColor:u="black",borderLeftStyle:g="solid",borderRightColor:f="black",borderRightStyle:m="solid",borderBottomColor:y="black",borderBottomStyle:b="solid"}=this.style,T={borderTopColor:c,borderTopWidth:i,borderTopStyle:p,borderLeftColor:u,borderLeftWidth:r,borderLeftStyle:g,borderRightColor:f,borderRightWidth:o,borderRightStyle:m,borderBottomColor:y,borderBottomWidth:s,borderBottomStyle:b,borderTopLeftRadius:a,borderTopRightRadius:h,borderBottomLeftRadius:l,borderBottomRightRadius:d},{width:w,height:E}=e,C=Math.min(h,.5*w,.5*E),v=Math.min(a,.5*w,.5*E),x=Math.min(d,.5*w,.5*E),R=Math.min(l,.5*w,.5*E);t.save(),t.strokeOpacity(n),i&&(t.save(),it(t,e,T,C,v),rt(t,e,T,C,v),t.restore()),o&&(t.save(),ot(t,e,T,C,x),st(t,e,T,C,x),t.restore()),s&&(t.save(),nt(t,e,T,R,x),at(t,e,T,R,x),t.restore()),r&&(t.save(),ht(t,e,T,R,v),lt(t,e,T,R,v),t.restore()),t.restore()}};const ct=(Math.sqrt(2)-1)/3*4,pt={clip(){const{top:t,left:e,width:i,height:r}=this.getAbsoluteLayout(),{borderTopLeftRadius:o=0,borderTopRightRadius:s=0,borderBottomRightRadius:n=0,borderBottomLeftRadius:a=0}=this.style,h=Math.min(s,.5*i,.5*r),l=h*(1-ct);this.root.instance.moveTo(e+h,t),this.root.instance.lineTo(e+i-h,t),this.root.instance.bezierCurveTo(e+i-l,t,e+i,t+l,e+i,t+h);const d=Math.min(n,.5*i,.5*r),c=d*(1-ct);this.root.instance.lineTo(e+i,t+r-d),this.root.instance.bezierCurveTo(e+i,t+r-c,e+i-c,t+r,e+i-d,t+r);const p=Math.min(a,.5*i,.5*r),u=p*(1-ct);this.root.instance.lineTo(e+p,t+r),this.root.instance.bezierCurveTo(e+u,t+r,e,t+r-u,e,t+r-p);const g=Math.min(o,.5*i,.5*r),f=g*(1-ct);this.root.instance.lineTo(e,t+g),this.root.instance.bezierCurveTo(e,t+f,e+f,t,e+g,t),this.root.instance.closePath(),this.root.instance.clip()}},ut=t=>{const e=/translateX\((-?\d+\.?d*)\)/g.exec(t),i=/translate\((-?\d+\.?d*).*,\s*(-?\d+\.?d*).*\)/g.exec(t);return e&&e[1]?e[1]:i&&i[1]?i[1]:0},gt=t=>{const e=/translateY\((-?\d+\.?\d*)\)/g.exec(t),i=/translate\((-?\d+\.?\d*).*,\s*(-?\d+\.?\d*).*\)/g.exec(t);return e&&e[1]?e[1]:i&&i[2]?i[2]:0},ft=t=>{const e=/scaleX\((-?\d+\.?\d*)\)/g.exec(t),i=/scale\((-?\d+\.?\d*).*,\s*(-?\d+\.?\d*).*\)/g.exec(t);return e&&e[1]?e[1]:i&&i[1]?i[1]:1},mt=t=>{const e=/scaleY\((-?\d+\.?\d*)\)/g.exec(t),i=/scale\((-?\d+\.?\d*).*,\s*(-?\d+\.?\d*).*\)/g.exec(t);return e&&e[1]?e[1]:i&&i[2]?i[2]:1},yt=(t,e,i)=>{/rotate/g.test(e)?t.root.instance.rotate((t=>{const e=/rotate\((-?\d+.?\d+)(.+)\)/g.exec(t);if(e&&e[1]&&e[2]){const t=e[1];return"rad"===e[2]?180*t/Math.PI:t}return 0})(e),{origin:i}):/scaleX/g.test(e)?t.root.instance.scale(ft(e),1,{origin:i}):/scaleY/g.test(e)?t.root.instance.scale(1,mt(e),{origin:i}):/scale/g.test(e)?t.root.instance.scale(ft(e),mt(e),{origin:i}):/translateX/g.test(e)?t.root.instance.translate(ut(e),1,{origin:i}):/translateY/g.test(e)?t.root.instance.translate(1,gt(e),{origin:i}):/translate/g.test(e)?t.root.instance.translate(ut(e),gt(e),{origin:i}):/matrix/g.test(e)&&t.root.instance.transform(...(t=>{const e=/matrix\(([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+)\)/g.exec(t);return e?e.slice(1,7):null})(e))},bt={applyTransformations(){let t;const e=/[a-zA-Z]+\([^)]+\)/g,i=this.origin,r=this.style&&this.style.transform||"";for(;null!=(t=e.exec(r));)yt(this,t[0],i)}};const Tt="production"!==process.env.NODE_ENV?(t,e,...i)=>{if(void 0===e)throw new Error("`warning(condition, format, ...args)` requires a warning message argument");t||function(t,...e){let i=0;const r="Warning: "+t.replace(/%s/g,()=>e[i++]);"undefined"!=typeof console&&console.error(r);try{throw new Error(r)}catch(t){}}(e,...i)}:()=>{},wt=["color","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","opacity","textDecoration","lineHeight","textAlign","visibility","wordSpacing"];class Et extends W{constructor(t,e){super(),this.root=t,this.style={},this.props=h({},this.constructor.defaultProps,Et.defaultProps,e),Tt(!this.props.styles,'"styles" prop passed instead of "style" prop')}get page(){return this.parent.page}get wrap(){return this.props.wrap}get break(){return this.props.break}get fixed(){return this.props.fixed}get minPresenceAhead(){return this.props.minPresenceAhead}get absolute(){return"absolute"===this.props.style.position}get origin(){const{transformOriginX:t,transformOriginY:e}=this.style,{left:i,top:r,width:o,height:s}=this.getAbsoluteLayout(),n=D(t),a=D(e);return[i+(n?o*n.percent:t),r+(a?s*a.percent:e)]}set break(t){this.props.break=t}appendChild(t){super.appendChild(t),this.root.markDirty()}appendChildBefore(t,e){super.appendChildBefore(t,e),this.root.markDirty()}removeChild(t){super.removeChild(t),this.root.markDirty()}update(t){this.props=h({},this.constructor.defaultProps,Et.defaultProps,t),this.root.markDirty()}applyProps(){this.style=this.resolveStyles(),l(this.style).map(([t,e])=>{this.applyStyle(t,e)}),this.children.forEach(t=>{t.applyProps&&t.applyProps()})}resolveStyles(){const{size:t,orientation:e}=this.page,i=Q.resolve(this.props.style,{orientation:e,width:t.width,height:t.height});return{...this.parent?a(this.parent.style,wt):{},...i}}applyStyle(t,e){if(void 0===e)return;const i=`set${O(t)}`;switch(t){case"marginTop":case"marginRight":case"marginBottom":case"marginLeft":case"paddingTop":case"paddingRight":case"paddingBottom":case"paddingLeft":case"borderTopWidth":case"borderRightWidth":case"borderBottomWidth":case"borderLeftWidth":case"position":case"top":case"right":case"bottom":case"left":case"width":case"height":case"minHeight":case"maxHeight":case"minWidth":case"maxWidth":this[t]=e;break;default:d(this.layout[i])&&this.layout[i](e)}}getLayoutData(){const t=this.getAbsoluteLayout();return{type:this.name,top:t.top,left:t.left,width:t.width,style:this.style,height:t.height,children:this.children.map(t=>t.getLayoutData())}}drawBackgroundColor(){const{backgroundColor:t,opacity:e=1}=this.style,{left:i,top:r,width:o,height:s}=this.getAbsoluteLayout();t&&(this.root.instance.save(),this.clip(),this.root.instance.fillOpacity(e).fillColor(t).rect(i,r,o,s).fill().restore())}clone(){const t=new this.constructor(this.root,this.props);return t.copyStyle(this),t.style=this.style,t}onNodeSplit(t,e){this.calculateLayout(),e.marginTop=0,e.paddingTop=0,e.style.height&&(e.height=this.height-t),this.height=t,this.marginBottom=0,this.paddingBottom=0}async renderChildren(){const t=this.children.filter(t=>t.absolute),e=this.children.filter(t=>!t.absolute);for(let t=0;t<e.length;t++)await e[t].render();for(let e=0;e<t.length;e++)await t[e].render()}}Et.defaultProps={style:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomRightRadius:0,borderBottomLeftRadius:0,transformOriginX:"50%",transformOriginY:"50%"},minPresenceAhead:0},Object.assign(Et.prototype,tt),Object.assign(Et.prototype,dt),Object.assign(Et.prototype,pt),Object.assign(Et.prototype,bt);const Ct=(t,e)=>Array.from({length:Math.ceil(t/e)},(t,i)=>i*e),vt=t=>{const e=D(t);return e?100/e.value:null},xt={getRulerWidth:()=>13,hasHorizontalRuler(){return this.props.ruler||this.props.horizontalRuler},hasVerticalRuler(){return this.props.ruler||this.props.verticalRuler},getHorizontalSteps(){const t=this.props.horizontalRulerSteps||this.props.rulerSteps||50;if("string"==typeof t){const e=vt(t);if(e){return(this.width-(this.hasVerticalRuler()?13:0))/e}throw new Error("Page: Invalid horizontal steps value")}return t},getVerticalSteps(){const t=this.props.verticalRulerSteps||this.props.rulerSteps||50;if("string"==typeof t){const e=vt(t);if(e){return(this.height-(this.hasHorizontalRuler()?13:0))/e}throw new Error("Page: Invalid horizontal steps value")}return t},renderRuler(){const t=this.hasHorizontalRuler(),e=this.hasVerticalRuler();(t||e)&&(this.root.instance.save().lineWidth(.5).fontSize(5).opacity(1),t&&this.drawHorizontalRuler(),e&&this.drawVerticalRuler(),t&&e&&this.root.instance.rect(0,0,12.5,12.5).fill("white"),this.root.instance.restore())},drawHorizontalRuler(){const t=this.hasVerticalRuler()?13:0;this.root.instance.rect(t,0,this.width,13).fill("white").moveTo(this.hasVerticalRuler()?13:0,13).lineTo(this.width,13).stroke("gray");const e=Ct(this.width,this.getHorizontalSteps());e.map(e=>{this.root.instance.moveTo(t+e,0).lineTo(t+e,13).stroke("gray").fillColor("black").text(`${Math.round(e)}`,t+e+1,1)}),e.map(e=>{0!==e&&this.root.instance.moveTo(t+e,13).lineTo(t+e,this.height).stroke("#ababab")})},drawVerticalRuler(){const t=this.hasHorizontalRuler()?13:0;this.root.instance.rect(0,t,13,this.height).fill("white").moveTo(13,this.hasHorizontalRuler()?13:0).lineTo(13,this.height).stroke("gray");const e=Ct(this.height,this.getVerticalSteps());e.map(e=>{this.root.instance.moveTo(0,t+e).lineTo(13,t+e).stroke("gray").fillColor("black").text(`${Math.round(e)}`,1,t+e+1)}),e.map(e=>{0!==e&&this.root.instance.moveTo(13,t+e).lineTo(this.width,t+e).stroke("#ababab")})}};class Rt{constructor(t,e){this.root=t,this.value=e,this.parent=null,this.props={}}get name(){return"TextInstance"}getLayoutData(){return this.value}remove(){this.parent.removeChild(this)}clone(){return new this.constructor(this.root,this.value)}update(t){this.value=t,this.parent.computed=!1,this.parent.container=null,this.root.markDirty()}}const St={"4A0":[4767.87,6740.79],"2A0":[3370.39,4767.87],A0:[2383.94,3370.39],A1:[1683.78,2383.94],A2:[1190.55,1683.78],A3:[841.89,1190.55],A4:[595.28,841.89],A5:[419.53,595.28],A6:[297.64,419.53],A7:[209.76,297.64],A8:[147.4,209.76],A9:[104.88,147.4],A10:[73.7,104.88],B0:[2834.65,4008.19],B1:[2004.09,2834.65],B2:[1417.32,2004.09],B3:[1000.63,1417.32],B4:[708.66,1000.63],B5:[498.9,708.66],B6:[354.33,498.9],B7:[249.45,354.33],B8:[175.75,249.45],B9:[124.72,175.75],B10:[87.87,124.72],C0:[2599.37,3676.54],C1:[1836.85,2599.37],C2:[1298.27,1836.85],C3:[918.43,1298.27],C4:[649.13,918.43],C5:[459.21,649.13],C6:[323.15,459.21],C7:[229.61,323.15],C8:[161.57,229.61],C9:[113.39,161.57],C10:[79.37,113.39],RA0:[2437.8,3458.27],RA1:[1729.13,2437.8],RA2:[1218.9,1729.13],RA3:[864.57,1218.9],RA4:[609.45,864.57],SRA0:[2551.18,3628.35],SRA1:[1814.17,2551.18],SRA2:[1275.59,1814.17],SRA3:[907.09,1275.59],SRA4:[637.8,907.09],EXECUTIVE:[521.86,756],FOLIO:[612,936],LEGAL:[612,1008],LETTER:[612,792],TABLOID:[792,1224]},Pt=(t,e="portrait")=>{let i;if("string"==typeof t)i=St[t.toUpperCase()];else if(Array.isArray(t))i=t;else{if("object"!=typeof t||!t.width||!t.height)throw new Error(`Invalid Page size: ${t}`);i=[t.width,t.height]}return"portrait"===e?{width:i[0],height:i[1]}:{width:i[1],height:i[0]}};class Lt extends Et{constructor(t,e){super(t,e),this._size=null}get name(){return"Page"}get document(){return this.parent}get page(){return this}get orientation(){return this.props.orientation}get size(){return this._size?this._size:(this._size=Pt(this.props.size,this.orientation),this.hasHorizontalRuler()&&(this._size.width+=this.getRulerWidth()),this.hasVerticalRuler()&&(this._size.height+=this.getRulerWidth()),this._size)}resetMargins(){(this.marginTop||this.marginBottom||this.marginLeft||this.marginRight)&&(Tt(!1,"Margin values are not allowed on Page element. Use padding instead."),this.marginTop=0,this.marginBottom=0,this.marginLeft=0,this.marginRight=0)}applyProps(){super.applyProps(),this.top=0,this.left=0,this.width=this.size.width,this.resetMargins();const t=this.getRulerWidth();this.hasHorizontalRuler()&&(this.paddingTop=this.paddingTop+t),this.hasVerticalRuler()&&(this.paddingLeft=this.paddingLeft+t)}setPadding(t,e){const i=t===n.EDGE_TOP||t===n.EDGE_BOTTOM?this.size.height:this.size.width,r=D(e);r?this.layout.setPadding(t,i*r.percent):this.layout.setPadding(t,e)}async addDynamicChild(t,e){if(!e)return;const i=Array.isArray(e)?e:[e];for(let e=0;e<i.length;e++){const r=i[e],{type:o,props:n}=r;if("string"==typeof r){const e=new Rt(this.root,r);t.appendChild(e)}else if(o!==s){const e=_e(r,this.root);await e.onAppendDynamically(),t.appendChild(e),e.applyProps(),await this.addDynamicChild(e,n.children)}else await this.addDynamicChild(t,n.children)}}async renderDynamicNodes(t,e){const i=this.children.slice(0);for(;i.length>0;){const r=i.shift();if((!e||e(r))&&r.props.render){r.removeAllChilds();const e=r.props.render(t);await this.addDynamicChild(r,e),r.fixed||(r.props.render=null)}else r.children&&i.push(...r.children)}}async nodeWillWrap(t){await this.renderDynamicNodes(t),this.calculateLayout()}onNodeSplit(t,e){e.marginTop=0,this.marginBottom=0,this.calculateLayout()}clone(){const t=super.clone();return t._size=this.size,t}update(t){super.update(t),this._size=null}async render(){const{instance:t}=this.root;this.height=this.size.height,this.calculateLayout(),t.addPage({size:[this.size.width,this.size.height],margin:0}),this.style.backgroundColor&&t.fillColor(this.style.backgroundColor).rect(0,0,this.size.width,this.size.height).fill(),await this.renderChildren(),this.props.debug&&this.debug(),this.renderRuler()}}Lt.defaultProps={size:"A4",wrap:!0,orientation:"portrait"},Object.assign(Lt.prototype,xt);class At extends Et{get name(){return"View"}async render(){this.root.instance.save(),this.applyTransformations(),this.drawBackgroundColor(),this.drawBorders(),await this.renderChildren(),this.props.debug&&this.debug(),this.root.instance.restore()}}At.defaultProps={wrap:!0};const Bt=async(t,e)=>{const i=await f(t,e),r=await(i.buffer?i.buffer():i.arrayBuffer());return"Buffer"===r.constructor.name?r:Buffer.from(r)};class Mt{constructor(t,e,i,r,o,s){this.src=t,this.fontFamily=e,this.fontStyle=i||"normal",this.fontWeight=U(r)||400,this.unicodeRange=o instanceof RegExp?o:/./,this.data=null,this.loading=!1,this.options=s}async load(){if(this.loading=!0,u(this.src)){const{headers:t,body:e,method:i="GET"}=this.options,r=await Bt(this.src,{method:i,body:e,headers:t});this.data=g.create(r)}else this.data=await new Promise((t,e)=>g.open(this.src,(i,r)=>i?e(i):t(r)));this.loading=!1}}class kt{static create(t){return new kt(t)}constructor(t){this.family=t,this.sources=[]}register({src:t,fontWeight:e,fontStyle:i,unicodeRange:r,...o}){this.sources.push(new Mt(t,this.fontFamily,i,e,r,o))}resolve(t){const{fontWeight:e=400,fontStyle:i="normal"}=t,r=this.sources.filter(t=>t.fontStyle===i),o=r.find(t=>t.fontWeight===e);if(o)return o;let s;if(e>=400&&e<=500){const t=r.filter(t=>t.fontWeight<=e),i=r.filter(t=>t.fontWeight>500);s=r.filter(t=>t.fontWeight>=e&&t.fontWeight<500)[0]||t[t.length-1]||i[0]}const n=r.filter(t=>t.fontWeight<e),a=r.filter(t=>t.fontWeight>e);if(e<400&&(s=n[n.length-1]||a[0]),e>500&&(s=a[0]||n[n.length-1]),!s)throw new Error(`Could not resolve font for ${this.fontFamily}, fontWeight ${e}`);return s}}let Ot;var Dt=["Courier","Courier-Bold","Courier-Oblique","Helvetica","Helvetica-Bold","Helvetica-Oblique","Times-Roman","Times-Bold","Times-Italic"];let Wt;let It={};const _t=t=>{const{fontFamily:e}=t;if(Dt.includes(e))return null;if(!It[e])throw new Error(`Font family not registered: ${e}. Please register it calling Font.register() method.`);return It[e].resolve(t)};var zt={register:(t,e)=>{"object"==typeof t?e=t:(Tt(!1,"Font.register will not longer accept the font source as first argument. Please move it into the data object. For more info refer to https://react-pdf.org/fonts"),e.src=t);const{family:i}=e;if(It[i]||(It[i]=kt.create(i)),e.fonts)for(let t=0;t<e.fonts.length;t++)It[i].register({family:i,...e.fonts[t]});else It[i].register(e)},getRegisteredFonts:()=>It,getRegisteredFontFamilies:()=>Object.keys(It),getFont:_t,load:function({fontFamily:t,...e},i,r){const o="string"==typeof t?t.split(",").map(t=>t.trim()):[...t||[]],s=[];for(const t of o){if(Dt.includes(t))break;const i=_t({...e,fontFamily:t});if(("string"!=typeof r||r.search(i.unicodeRange)>=0)&&!i.data&&!i.loading&&(s.push(i.load()),"."===i.unicodeRange.source))break}return Promise.all(s)},clear:function(){It={}},reset:function(){for(const t in It)It.hasOwnProperty(t)&&(It[t].data=null)},...{registerEmojiSource:({url:t,format:e="png"})=>{Ot={url:t,format:e}},getEmojiSource:()=>Ot},...{registerHyphenationCallback:t=>{Wt=t},getHyphenationCallback:()=>Wt}};const Ft=/^([a-z]+\:(\/\/)?)/i,Gt=t=>t?"string"!=typeof t||t.match(Ft)?t:`http://${t}`:"";class Nt{constructor(t){this.name=t,this.src=o.open(null,t)}layout(t){const[e,i]=this.src.encode(t);return{positions:i,stringIndices:i.map((t,e)=>e),glyphs:e.map((t,e)=>{const r=this.getGlyph(parseInt(t,16));return r.advanceWidth=i[e].advanceWidth,r})}}glyphForCodePoint(t){const e=this.getGlyph(t);return e.advanceWidth=400,e}getGlyph(t){return{id:t,_font:this.src,codePoints:[t],isLigature:!1,name:this.src.font.characterToGlyph(t)}}hasGlyphForCodePoint(t){return".notdef"!==this.src.font.characterToGlyph(t)}get ascent(){return this.src.ascender}get descent(){return this.src.descender}get lineGap(){return this.src.lineGap}get unitsPerEm(){return 1e3}}var jt=()=>({Run:t})=>(class{constructor(){this.fontCache={}}get fallbackFont(){return this.getOrCreateFont("Helvetica")}getOrCreateFont(t){if(this.fontCache[t])return this.fontCache[t];const e=new Nt(t);return this.fontCache[t]=e,e}shouldFallbackToFont(t,e){return!e.hasGlyphForCodePoint(t)&&this.fallbackFont.hasGlyphForCodePoint(t)}getRuns(e,i){const r=[];let o=null,s=0,n=0;for(const a of i){const i="string"==typeof a.attributes.font?this.getOrCreateFont(a.attributes.font):a.attributes.font;if(0===e.length){r.push(new t(0,0,{font:i}));break}for(const h of e.slice(a.start,a.end)){const e=h.codePointAt(),a=this.shouldFallbackToFont(e,i)?this.fallbackFont:i;a!==o&&(o&&r.push(new t(s,n,{font:o})),o=a,s=n),n+=h.length}}return s<e.length&&r.push(new t(s,e.length,{font:o})),r}});const Ht=require("hyphen"),Ut=require("hyphen/patterns/en-us"),Vt=Ht(Ut);var Xt=({hyphenationCallback:t})=>()=>(class{constructor(){this.cache={}}calculateParts(t){return t.includes("­")?t.split("­"):Vt(t).split("­")}hyphenateWord(e){if(this.cache[e])return this.cache[e];const i=t?t(e):this.calculateParts(e);return this.cache[e]=i,i}});class $t{constructor(){this.head=null,this.tail=null,this.listSize=0}isLinked(t){return!(t&&null===t.prev&&null===t.next&&this.tail!==t&&this.head!==t||this.isEmpty())}size(){return this.listSize}isEmpty(){return 0===this.listSize}first(){return this.head}last(){return this.last}toString(){return this.toArray().toString()}toArray(){let t=this.head;const e=[];for(;null!==t;)e.push(t),t=t.next;return e}forEach(t){let e=this.head;for(;null!==e;)t(e),e=e.next}contains(t){let e=this.head;if(!this.isLinked(t))return!1;for(;null!==e;){if(e===t)return!0;e=e.next}return!1}at(t){let e=this.head,i=0;if(t>=this.listLength||t<0)return null;for(;null!==e;){if(t===i)return e;e=e.next,i+=1}return null}insertAfter(t,e){return this.isLinked(t)?(e.prev=t,e.next=t.next,null===t.next?this.tail=e:t.next.prev=e,t.next=e,this.listSize+=1,this):this}insertBefore(t,e){return this.isLinked(t)?(e.prev=t.prev,e.next=t,null===t.prev?this.head=e:t.prev.next=e,t.prev=e,this.listSize+=1,this):this}push(t){return null===this.head?this.unshift(t):this.insertAfter(this.tail,t),this}unshift(t){return null===this.head?(this.head=t,this.tail=t,t.prev=null,t.next=null,this.listSize+=1):this.insertBefore(this.head,t),this}remove(t){return this.isLinked(t)?(null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this.listSize-=1,this):this}pop(){const t=this.tail;return this.tail.prev.next=null,this.tail=this.tail.prev,this.listSize-=1,t.prev=null,t.next=null,t}shift(){const t=this.head;return this.head.next.prev=null,this.head=this.head.next,this.listSize-=1,t.prev=null,t.next=null,t}}$t.Node=class{constructor(t){this.prev=null,this.next=null,this.data=t}toString(){return this.data.toString()}};const Yt=(t,e,i)=>{const r={demerits:{line:i&&i.demerits&&i.demerits.line||10,flagged:i&&i.demerits&&i.demerits.flagged||100,fitness:i&&i.demerits&&i.demerits.fitness||3e3},tolerance:i&&i.tolerance||3},o=new $t,s={width:0,stretch:0,shrink:0},n=e,a=[];let h={data:{demerits:1/0}};function l(t,e,i,r,o,s,n){return{position:t,demerits:e,ratio:i,line:r,fitnessClass:o,totals:s||{width:0,stretch:0,shrink:0},previous:n}}function d(e,i,r,o){let a=s.width-r.totals.width,h=0,l=0;const d=o<n.length?n[o-1]:n[n.length-1];return"penalty"===t[i].type&&(a+=t[i].width),a<d?(h=s.stretch-r.totals.stretch)>0?(d-a)/h:Yt.infinity:a>d?(l=s.shrink-r.totals.shrink)>0?(d-a)/l:Yt.infinity:0}function c(e){const i={width:s.width,stretch:s.stretch,shrink:s.shrink};for(let r=e;r<t.length;r+=1)if("glue"===t[r].type)i.width+=t[r].width,i.stretch+=t[r].stretch,i.shrink+=t[r].shrink;else if("box"===t[r].type||"penalty"===t[r].type&&t[r].penalty===-Yt.infinity&&r>e)break;return i}function p(t,e,i){let s,n,a,h,p,u=o.first(),g=null,f=0,m=0,y=[],b=0,T=0;for(;null!==u;){for(y=[{demerits:1/0},{demerits:1/0},{demerits:1/0},{demerits:1/0}];null!==u&&(g=u.next,b=u.data.line+1,((f=d(u.data.position,e,u.data,b))<-1||"penalty"===t.type&&t.penalty===-Yt.infinity)&&o.remove(u),f>=-1&&f<=r.tolerance&&(s=100*Math.pow(Math.abs(f),3),m="penalty"===t.type&&t.penalty>=0?Math.pow(r.demerits.line+s,2)+Math.pow(t.penalty,2):"penalty"===t.type&&t.penalty!==-Yt.infinity?Math.pow(r.demerits.line+s,2)-Math.pow(t.penalty,2):Math.pow(r.demerits.line+s,2),"penalty"===t.type&&"penalty"===i[u.data.position].type&&(m+=r.demerits.flagged*t.flagged*i[u.data.position].flagged),T=f<-.5?0:f<=.5?1:f<=1?2:3,Math.abs(T-u.data.fitnessClass)>1&&(m+=r.demerits.fitness),(m+=u.data.demerits)<y[T].demerits&&(y[T]={active:u,demerits:m,ratio:f})),!(null!==(u=g)&&u.data.line>=b)););for(n=c(e),a=0;a<y.length;a+=1)(h=y[a]).demerits<1/0&&(p=new $t.Node(l(e,h.demerits,h.ratio,h.active.data.line+1,a,n,h.active)),null!==u?o.insertBefore(u,p):o.push(p))}}if(o.push(new $t.Node(l(0,0,0,0,0,void 0,null))),t.forEach((t,e,i)=>{"box"===t.type?s.width+=t.width:"glue"===t.type?(e>0&&"box"===i[e-1].type&&p(t,e,i),s.width+=t.width,s.stretch+=t.stretch,s.shrink+=t.shrink):"penalty"===t.type&&t.penalty!==Yt.infinity&&p(t,e,i)}),0!==o.size()){for(o.forEach(t=>{t.data.demerits<h.data.demerits&&(h=t)});null!==h;)a.push({position:h.data.position,ratio:h.data.ratio}),h=h.data.previous;return a.reverse()}return[]};Yt.infinity=1e4,Yt.glue=((t,e,i,r)=>({type:"glue",value:e,width:t,stretch:i,shrink:r})),Yt.box=((t,e,i=!1)=>({type:"box",width:t,value:e,hyphenated:i})),Yt.penalty=((t,e,i)=>({type:"penalty",width:t,penalty:e,flagged:i}));const Jt=(t,e,i)=>{let r=null,o=1/0;const s={width:0,stretch:0,shrink:0},n=e[Math.min(i,e.length-1)],a=t=>s.width<n?s.stretch-t.stretch>0?(n-s.width)/s.stretch:1e4:s.width>n?s.shrink-t.shrink>0?(n-s.width)/s.shrink:1e4:0;for(let e=0;e<t.length;e++){const i=t[e];if("box"===i.type?s.width+=i.width:"glue"===i.type&&(s.width+=i.width,s.stretch+=i.stretch,s.shrink+=i.shrink),s.width-s.shrink>n)break;if("penalty"===i.type||"glue"===i.type){const t=a(i),s="penalty"===i.type?i.penalty:0,n=100*Math.pow(Math.abs(t),3)+s;o>=n&&(r=e,o=n)}}return s.width-s.shrink>n?r:null},qt=3,Kt=6,Zt=9;var Qt=({penalty:t}={})=>()=>(class{constructor(t){this.tolerance=t||4}getNodes(e,i,{align:r}){let o=0;const s=t||("justify"===r?100:600),n=i.reduce((t,r,n)=>{const a=e.glyphIndexForStringIndex(o),h=e.glyphIndexForStringIndex(o+r.length),l=e.slice(a,h);if(""===l.string.trim()){const e=l.advanceWidth,i=e*qt/Kt,r=e*qt/Zt,s={value:l,start:o,end:o+l.end};t.push(Yt.glue(e,s,i,r))}else{const e=" "!==i[n+1],r={value:l,start:o,end:o+l.end};t.push(Yt.box(l.advanceWidth,r,e)),i[n+1]&&e&&t.push(Yt.penalty(5,s,1))}return o+=r.length,t},[]);return n.push(Yt.glue(0,null,Yt.infinity,0)),n.push(Yt.penalty(0,-Yt.infinity,1)),n}breakLines(t,e,i){let r=0,o=null;const s=i.reduce((i,s)=>{const n=e[s.position],a=e[s.position-1];if(s.position===e.length-1)return i;let h;return"penalty"===n.type?(o=t.glyphIndexForStringIndex(a.value.end),(h=t.copy().slice(r,o)).insertGlyph(h.length,45)):(o=t.glyphIndexForStringIndex(n.value.end),h=t.copy().slice(r,o)),r=o,[...i,h]},[]),n=t.slice(r,t.glyphIndexForStringIndex(t.string.length));return s.push(n),s}suggestLineBreak(t,e,i,r){const o=this.getNodes(t,e,r);let s=this.tolerance,n=Yt(o,i,{tolerance:s});for(;0===n.length&&s<50;)n=Yt(o,i,{tolerance:s+=5});return(0===n.length||1===n.length&&0===n[0].position)&&(n=((t,e)=>{let i=0,r=0,o=t;const s=[{position:0}];for(;o.length>0;){const t=Jt(o,e,r);t?(i+=t,s.push({position:i}),o=o.slice(t+1,o.length),i++,r++):o=[]}return s})(o,i)),this.breakLines(t,o,n.slice(1))}});const te={before:-.5,after:-.5};class ee extends m{constructor({hyphenationCallback:t,hyphenationPenalty:e}){super({scriptItemizer:C(),decorationEngine:x(),fontSubstitutionEngine:jt(),wordHyphenation:Xt({hyphenationCallback:t}),lineBreaker:Qt({penalty:e}),justificationEngine:v({shrinkWhitespaceFactor:te})})}}M.isValid=function(t){try{return!!new M(t)}catch(t){return!1}};const ie=[65472,65473,65474,65475,65477,65478,65479,65480,65481,65482,65483,65484,65485,65486,65487];class re{constructor(t){if(this.data=null,this.width=null,this.height=null,this.data=t,65496!==t.readUInt16BE(0))throw new Error("SOI not found in JPEG");let e,i=2;for(;i<t.length&&(e=t.readUInt16BE(i),i+=2,!ie.includes(e));)i+=t.readUInt16BE(i);if(!ie.includes(e))throw new Error("Invalid JPEG.");i+=3,this.height=t.readUInt16BE(i),i+=2,this.width=t.readUInt16BE(i)}}re.isValid=function(t){if(!t||!Buffer.isBuffer(t)||65496!==t.readUInt16BE(0))return!1;let e,i=2;for(;i<t.length&&(e=t.readUInt16BE(i),i+=2,!ie.includes(e));)i+=t.readUInt16BE(i);return!!ie.includes(e)};class oe{constructor(t){if(this.data=null,this.width=null,this.height=null,71!==t[0]||73!==t[1]||70!==t[2])throw new TypeError("Image passed to GIF decoder appears not to be in GIF format")}}oe.isValid=function(t){try{return 71===t[0]&&73===t[1]&&70===t[2]}catch(t){return!1}};const se=(({limit:t=100}={})=>{let e={},i=[];return{get:t=>e[t],set:(r,o)=>{i.push(r),i.length>t&&delete e[i.shift()],e[r]=o},reset:()=>{e={},i=[]},length:()=>i.length}})({limit:30}),ne=t=>{const{protocol:e,auth:i,host:r,port:o,hostname:s,path:n}=S.parse(t),a=P.resolve(n);if(!(e&&"file:"!==e||i||r||o||s))return a},ae=(e,{safePath:i,allowDangerousPaths:r=!1}={})=>new Promise((o,s)=>{try{const n=ne(e);if(!n)return s(new Error(`Cannot fetch non-local path: ${e}`));if(!r&&((t,{safePath:e="./public"}={})=>{const i=P.resolve(e);return!P.resolve(t).startsWith(i)})(n,{safePath:i}))return s(new Error(`Cannot fetch dangerous local path: ${e}`));t.readFile(n,(t,e)=>t?s(t):o(e))}catch(t){s(t)}}),he=async(t,e)=>{switch(e.toLowerCase()){case"jpg":case"jpeg":return new re(t);case"png":return new M(t);case"gif":throw new Error("Cannot render GIF images outside a browser environment");default:return null}},le=t=>{const e=(t=>{let e;return re.isValid(t)?e="jpg":M.isValid(t)?e="png":oe.isValid(t)&&(e="gif"),e})(t);if(e)return he(t,e)},de=async(t,e)=>{const{uri:i,body:r,headers:o,method:s="GET"}=t,n=ne(i)?await ae(i,e):await(async(t,e)=>{const i=await f(t,e),r=await(i.buffer?i.buffer():i.arrayBuffer());return"Buffer"===r.constructor.name?r:Buffer.from(r)})(i,{body:r,headers:o,method:s}),a=(t=>{const e=137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7],i=255===t[0]&&216===t[1]&&255===t[2],r=71===t[0]&&73===t[1]&&70===t[2];let o="";if(e)o="png";else if(i)o="jpg";else{if(!r)throw new Error("Not valid image extension");o="gif"}return o})(n);return he(n,a)},ce=(t,{cache:e=!0,...i}={})=>{const r=t.data?t.data.toString():t.uri;if(e&&se.get(r))return se.get(r);let o;if(!(o=(({uri:t})=>/^data:image\/[a-zA-Z]*;base64,[^"]*/.test(t))(t)?(({uri:t})=>{const[,e,i]=/^data:image\/([a-zA-Z]*);base64,([^"]*)/.exec(t);if(!(t=>{const e=t.toLowerCase();return"jpg"===e||"jpeg"===e||"png"===e||"gif"===e})(e))throw new Error(`Base64 image invalid format: ${e}`);return he(Buffer.from(i,"base64"),e)})(t):Buffer.isBuffer(t)?le(t):"object"==typeof t&&t.data?(t=>{if(t.data&&t.format)return he(t.data,t.format);throw new Error(`Invalid data given for local file: ${JSON.stringify(t)}`)})(t):de(t,i)))throw new Error("Cannot resolve image");return e&&se.set(r,o),o},pe={},ue=R(),ge=()=>(t=>(...e)=>t(...e).then(t=>t,t=>t))(ce),fe=t=>"️"!==t,me=t=>{const{url:e,format:i}=zt.getEmojiSource();return`${e}${(t=>Array.from(t).filter(fe).map(t=>t.codePointAt(0).toString(16)).join("-"))(t)}.${i}`},ye=t=>{const e=zt.getEmojiSource();if(!e||!e.url)return[];const i=[];let r;for(;r=ue.exec(t);){const t=r[0];if(!pe[t]||pe[t].loading){const e=me(t);pe[t]={loading:!0};const r=ge();i.push(r({uri:e}).then(e=>{pe[t].loading=!1,pe[t].data=e.data}))}}return i},be=[8232,8233],Te=[t=>t.map(t=>{const e=(t=>be.reduce((e,i)=>t.hasGlyphForCodePoint&&t.hasGlyphForCodePoint(i)?e:[...e,String.fromCharCode(i)],[]))(t.attributes.font),i=new RegExp(e.join("|"));return{string:t.string.replace(i,""),attributes:t.attributes}}),t=>{const e=[];for(let i=0;i<t.length;i++){const r=t[i];let o,s=0;for(;o=ue.exec(r.string);){const t=o.index,i=o[0],n=r.attributes.fontSize,a=r.string.slice(s,t+o[0].length);pe[i]&&pe[i].data?e.push({string:a.replace(o,y.CHARACTER),attributes:{...r.attributes,attachment:new y(n,n,{yOffset:Math.floor(.1*n),image:pe[i].data})}}):e.push({string:a.replace(o,String.fromCharCode(0)),attributes:r.attributes}),s=t+i.length}s<r.string.length&&e.push({string:r.string.slice(s),attributes:r.attributes})}return e}],we=t=>{if(!t)return[{string:""}];let e=[];const{color:i="black",backgroundColor:r,fontFamily:o="Helvetica",fontWeight:s,fontStyle:n,fontSize:a=18,textAlign:h="left",position:l,top:d,bottom:c,lineHeight:p,textDecoration:u,textDecorationColor:g,textDecorationStyle:f,textTransform:m,letterSpacing:y,opacity:b}=t.style;t.children.forEach(T=>{if(null!==T.value&&void 0!==T.value){const w=zt.getFont({fontFamily:o,fontWeight:s,fontStyle:n}),E=w?w.data:o,C=((t,e)=>{switch(e){case"uppercase":return t.toUpperCase();case"lowercase":return t.toLowerCase();case"capitalize":return(t=>t.replace(/(^|\s)\S/g,t=>t.toUpperCase()))(t);default:return t}})(T.value,m);e.push({string:C,attributes:{font:E,color:i,opacity:b,fontSize:a,backgroundColor:r,align:h,link:t.src,characterSpacing:y,underlineStyle:f,underline:"underline"===u,underlineColor:g||i,lineHeight:p?p*a:null,yOffset:"relative"===l?-d||c||0:null}})}else T&&e.push(...we(T))});for(const t of Te)e=t(e);return e},Ee=t=>b.fromFragments(we(t)).trim(),Ce={outlineLines:!1},ve=p({Rect:T});class xe extends Et{constructor(t,e){super(t,e),this.start=0,this.end=0,this.computed=!1,this.container=null,this.attributedString=null,this.layoutEngine=new ee({hyphenationPenalty:e.hyphenationPenalty,hyphenationCallback:zt.getHyphenationCallback()}),this.layout.setMeasureFunc(this.measureText.bind(this))}get name(){return"Text"}get src(){return Gt(this.props.src||this.props.href)}get lines(){return this.container?this.container.blocks.reduce((t,e)=>[...t,...e.lines],[]).splice(this.start,this.end):[]}get linesHeight(){return this.container?this.lines.reduce((t,e)=>t+e.height,0):-1}get linesWidth(){return this.container?Math.max(...this.lines.map(t=>t.advanceWidth)):-1}appendChild(t){t&&(t.parent=this,this.children.push(t),this.computed=!1,this.attributedString=null,this.markDirty())}removeChild(t){const e=this.children.indexOf(t);-1!==e&&(t.parent=null,this.children.splice(e,1),this.computed=!1,this.attributedString=null,this.markDirty())}lineIndexAtHeight(t){let e=0;for(let i=0;i<this.lines.length;i++){const r=this.lines[i];if(e+r.height>t)return i;e+=r.height}return this.lines.length}heightAtLineIndex(t){let e=0;for(let i=0;i<t;i++){e+=this.lines[i].height}return e}layoutText(t,e){this.attributedString=Ee(this);const i=e||this.page.size.height;if(!this.container||this.props.render){const e=(new w).rect(0,0,t,i),r=new E(e),o=this.attributedString;this.layoutEngine.layout(o,[r]),this.container=r}const r=this.container.blocks.reduce((t,e)=>t+e.lines.length,0);this.end=this.props.maxLines||r+1,this.computed=!0}measureText(t,e,i,r){return e===n.MEASURE_MODE_EXACTLY?(this.layoutText(t),{height:this.style.flexGrow?NaN:this.linesHeight}):e===n.MEASURE_MODE_AT_MOST||r===n.MEASURE_MODE_AT_MOST?(this.layoutText(t,i),{height:this.linesHeight,width:Math.min(t,this.linesWidth)}):{}}resolveStyles(){const t=super.resolveStyles();return this.parent&&"Text"===this.parent.name&&"relative"===this.parent.style.position&&(t.top=t.top||this.parent.style.top,t.bottom=t.bottom||this.parent.style.bottom,t.position=t.position||"relative"),this.src&&(t.color=t.color||"blue",t.textDecoration=t.textDecoration||"underline"),t}wrapHeight(t){const{orphans:e,widows:i}=this.props,r=this.lines.length,o=t-this.paddingTop,s=this.lineIndexAtHeight(o);return r<e?t:s<e||r<e+i?0:r===e+i?this.heightAtLineIndex(e):r-s<i?t-this.heightAtLineIndex(i-1):t}onNodeSplit(t,e){const i=this.wrapHeight(t),r=this.lineIndexAtHeight(i);e.marginTop=0,e.paddingTop=0,e.start=r,e.attributedString=this.attributedString,this.height=i,this.marginBottom=0,this.paddingBottom=0,this.end=r}clone(){const t=super.clone();return t.layoutEngine=this.layoutEngine,this.container&&!this.props.render&&(t.container=this.container.copy()),t}async render(){this.root.instance.save(),this.applyTransformations(),this.drawBackgroundColor(),this.drawBorders(),this.computed||this.layoutText(this.width-this.padding.left-this.padding.right,this.height-this.padding.top-this.padding.bottom);const{top:t,left:e}=this.getAbsoluteLayout(),i=this.lines[0]?this.lines[0].rect.y:0;this.lines.forEach(r=>{r.rect.x+=e+this.padding.left,r.rect.y+=t+this.padding.top-i});const r={...this.container,blocks:[{lines:this.lines}]};new ve(this.root.instance,Ce).render(r),this.props.debug&&this.debug(),this.root.instance.restore()}}xe.defaultProps={wrap:!0,widows:2,orphans:2};class Re extends Et{get name(){return"Note"}appendChild(t){if("TextInstance"!==t.name)throw new Error("Note only accepts string children");t&&(t.parent=this,this.children.push(t))}removeChild(t){const e=this.children.indexOf(t);-1!==e&&(t.parent=null,this.children.splice(e,1))}applyProps(){super.applyProps(),this.height=0,this.width=0}async render(){const{top:t,left:e}=this.getAbsoluteLayout(),i=this.children[0]?this.children[0].value:"";this.root.instance.note(e,t,0,0,i)}}Re.defaultProps={};const Se=t=>!isNaN(parseFloat(t))&&isFinite(t),Pe=(t,e,i,r,o,s)=>{const n=t/e,a=i/r,h=D(o),l=D(s),d=h?h.percent:.5,c=l?l.percent:.5;if(n>a){const i=e,r=i*a,n=Se(s)?s:0;return{width:r,height:i,xOffset:Se(o)?o:(t-r)*d,yOffset:n}}{const i=t,r=i/a,n=Se(o)?o:0;return{width:i,height:r,yOffset:Se(s)?s:(e-r)*c,xOffset:n}}},Le=(t,e,i,r,o,s)=>{const n=i,a=r,h=D(o),l=D(s),d=h?h.percent:.5,c=l?l.percent:.5;return{width:n,height:a,xOffset:Se(o)?o:(t-n)*d,yOffset:Se(s)?s:(e-a)*c}},Ae=(t="fill",e,i,r,o,s,n)=>{switch(t){case"contain":return Pe(e,i,r,o,s,n);case"cover":return((t,e,i,r,o,s)=>{const n=i/r,a=t/e,h=D(o),l=D(s),d=h?h.percent:.5,c=l?l.percent:.5;if(a>n){const i=t,r=i/n,a=Se(o)?o:0;return{width:i,height:r,yOffset:Se(s)?s:(e-r)*c,xOffset:a}}{const i=e*n;return{width:i,height:e,xOffset:Se(o)?o:(t-i)*d,yOffset:Se(s)?s:0}}})(e,i,r,o,s,n);case"none":return Le(e,i,r,o,s,n);case"scale-down":return((t,e,i,r,o,s)=>{const n=Pe(t,e,i,r,o,s),a=Le(t,e,i,r,o,s);return n.width<a.width?n:a})(e,i,r,o,s,n);default:return((t,e,i,r)=>({width:t,height:e,xOffset:D(i)?0:i||0,yOffset:D(r)?0:r||0}))(e,i,s,n)}},Be=10;class Me extends Et{constructor(t,e){super(t,e),this.image=null,this.layout.setMeasureFunc(this.measureImage.bind(this))}get name(){return"Image"}shouldGrow(){return!!this.style.flexGrow}measureImage(t,e,i,r){const o=this.margin,s=this.page.padding,a=this.page.size.height-s.top-s.bottom-o.top-o.bottom-Be;if(!this.image)return{width:0,height:0};if(e===n.MEASURE_MODE_EXACTLY&&r===n.MEASURE_MODE_UNDEFINED){const e=t/this.ratio;return{height:Math.min(a,e)}}if(r===n.MEASURE_MODE_EXACTLY&&(e===n.MEASURE_MODE_AT_MOST||e===n.MEASURE_MODE_UNDEFINED))return{width:Math.min(i*this.ratio,t)};if(e===n.MEASURE_MODE_EXACTLY&&r===n.MEASURE_MODE_AT_MOST){const e=t/this.ratio;return{height:Math.min(i,a,e)}}return e===n.MEASURE_MODE_AT_MOST&&r===n.MEASURE_MODE_AT_MOST?this.ratio>1?{width:t,height:Math.min(t/this.ratio,i)}:{width:Math.min(i*this.ratio,t),height:i}:{height:i,width:t}}get ratio(){return this.image.data?this.image.width/this.image.height:1}get src(){const t=this.props.src||this.props.source;return"string"==typeof t?{uri:t}:t}async fetch(){const{cache:t,safePath:e,allowDangerousPaths:i}=this.props;if(this.src)try{this.image=await ce(this.src,{cache:t,safePath:e,allowDangerousPaths:i})}catch(t){this.image={width:0,height:0},console.warn(t.message)}else Tt(!1,'Image should receive either a "src" or "source" prop')}clone(){const t=super.clone();return t.image=this.image,t}async onAppendDynamically(){await this.fetch()}renderImage(){const t=this.padding,{left:e,top:i}=this.getAbsoluteLayout(),{opacity:r,objectPositionX:o,objectPositionY:s}=this.style;if(this.root.instance.save(),this.clip(),this.image.data){const{width:n,height:a,xOffset:h,yOffset:l}=Ae(this.style.objectFit,this.width-t.left-t.right,this.height-t.top-t.bottom,this.image.width,this.image.height,o,s);0!==n&&0!==a?this.root.instance.fillOpacity(r).image(this.image.data,e+t.left+h,i+t.top+l,{width:n,height:a}):Tt(!1,`Image with src '${this.props.src}' skipped due to invalid dimensions`)}this.root.instance.restore()}async render(){this.root.instance.save(),this.applyTransformations(),this.drawBackgroundColor(),this.renderImage(),this.drawBorders(),this.props.debug&&this.debug(),this.root.instance.restore()}}Me.defaultProps={wrap:!1,cache:!0,style:{}};class ke{constructor(t,e){this.root=t,this.style={},this.props=e,this.children=[],this.subpages=[]}get name(){return"Document"}appendChild(t){t.parent=this,this.children.push(t)}removeChild(t){const e=this.children.indexOf(t);t.parent=null,this.children.slice(e,1)}addMetaData(){const{title:t,author:e,subject:i,keywords:r,creator:o,producer:s}=this.props;t&&(this.root.instance.info.Title=t),e&&(this.root.instance.info.Author=e),i&&(this.root.instance.info.Subject=i),r&&(this.root.instance.info.Keywords=r),this.root.instance.info.Creator=o||"react-pdf",this.root.instance.info.Producer=s||"react-pdf"}async loadFontsAndEmojis(){const t=[],e=this.children.map(t=>[t,{}]);for(;e.length>0;){const[i,{parentStyle:r={}}]=e.shift();"string"==typeof i?t.push(...ye(i),zt.load(r,this.root.instance,i)):"string"==typeof i.value?t.push(...ye(i.value),zt.load(i.style||r,this.root.instance,i.value)):i.children&&i.children.forEach(t=>{e.push([t,{parentStyle:{...r,...i.style}}])})}await Promise.all(t)}async loadImages(){const t=[],e=this.children.slice(0);for(;e.length>0;){const i=e.shift();"Image"===i.name&&t.push(i.fetch()),i.children&&i.children.forEach(t=>{e.push(t)})}await Promise.all(t)}async loadAssets(){await Promise.all([this.loadFontsAndEmojis(),this.loadImages()])}applyProps(){this.children.forEach(t=>t.applyProps())}update(t){this.props=t}getLayoutData(){return{type:this.name,children:this.subpages.map(t=>t.getLayoutData())}}async wrapPages(){let t=1;const e=[];for(const i of this.children){const r=i.size.height-(i.style.paddingBottom||0);if(i.wrap){const o=await k(i,r,t);t+=o.length,e.push(...o)}else i.height=i.size.height,e.push(i)}return e}async renderPages(){this.subpages=await this.wrapPages();for(let t=0;t<this.subpages.length;t++)this.subpages[t].renderDynamicNodes({pageNumber:t+1,totalPages:this.subpages.length},t=>"Text"===t.name),await this.subpages[t].render();return this.subpages}async render(){try{this.addMetaData(),this.applyProps(),await this.loadAssets(),await this.renderPages(),this.root.instance.end(),zt.reset()}catch(t){throw t}}}ke.defaultProps={author:null,keywords:null,subject:null,title:null};const Oe=["dash","clip","save","path","fill","font","text","rect","scale","moveTo","lineTo","stroke","rotate","circle","lineCap","opacity","ellipse","polygon","restore","lineJoin","fontSize","fillColor","lineWidth","translate","miterLimit","strokeColor","fillOpacity","roundedRect","strokeOpacity","bezierCurveTo","quadraticCurveTo","linearGradient","radialGradient"],De=function(t){const e=Oe.reduce((i,r)=>({...i,[r]:(...i)=>(t[r](...i),e)}),{});return e};class We extends Et{get name(){return"Canvas"}async render(){const{left:t,top:e,width:i,height:r}=this.getAbsoluteLayout(),o=i-this.paddingLeft-this.paddingRight,s=r-this.paddingTop-this.paddingBottom;Tt(o&&s,"Canvas element has null width or height. Please provide valid values via the `style` prop in order to correctly render it."),this.root.instance.save(),this.applyTransformations(),this.drawBackgroundColor(),this.drawBorders(),this.clip(),this.root.instance.translate(t+this.paddingLeft,e+this.paddingTop),this.props.paint&&this.props.paint(De(this.root.instance),o,s),this.root.instance.restore(),this.props.debug&&this.debug()}}We.defaultProps={style:{},wrap:!1};const Ie={ROOT:class{constructor(){this.isDirty=!1,this.document=null,this.instance=null}get name(){return"Root"}appendChild(t){this.document=t}removeChild(){this.document=null}markDirty(){this.isDirty=!0}async render(){this.instance=new r({autoFirstPage:!1}),await this.document.render(),this.isDirty=!1}},PAGE:Lt,TEXT:xe,LINK:class extends Et{get name(){return"Link"}get src(){return Gt(this.props.src||this.props.href)}async render(){const{top:t,left:e,width:i,height:r}=this.getAbsoluteLayout();this.root.instance.link(e,t,i,r,this.src),await this.renderChildren(),this.props.debug&&this.debug()}},VIEW:At,NOTE:Re,IMAGE:Me,CANVAS:We,DOCUMENT:ke,TEXT_INSTANCE:Rt};function _e(t,e){const{type:i,props:r={}}=t;if(Ie[i])return new Ie[i](e,r);throw new Error(`Invalid element of type ${i} passed to PDF renderer`)}const ze=(t,e)=>{const i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let r=0;r<i.length;r++){const o=i[r];if("render"!==o){if("children"!==o&&t[o]!==e[o]){if("object"==typeof t[o]&&"object"==typeof e[o]&&ze(t[o],e[o]))continue;return!1}if("children"===o&&("string"==typeof t[o]||"string"==typeof e[o]))return t[o]===e[o]}else if(!t[o]!=!e[o])return!1}return!0},Fe={},Ge=i({supportsMutation:!0,appendInitialChild(t,e){t.appendChild(e)},createInstance:(t,e,i)=>_e({type:((t,e)=>"LINK"===t&&("string"==typeof e.children||"number"==typeof e.children||Array.isArray(e.children)||e.render))(t,e)?"TEXT":t,props:e},i),createTextInstance:(t,e)=>_e({type:"TEXT_INSTANCE",props:t},e),finalizeInitialChildren:(t,e,i)=>!1,getPublicInstance:t=>t,prepareForCommit(){},prepareUpdate:(t,e,i,r)=>!ze(i,r),resetAfterCommit(){},resetTextContent(t){},getRootHostContext:()=>Fe,getChildHostContext:()=>Fe,shouldSetTextContent:(t,e)=>!1,now:Date.now,useSyncScheduling:!0,appendChild(t,e){t.appendChild(e)},appendChildToContainer(t,e){t.appendChild(e)},insertBefore(t,e,i){t.appendChildBefore(e,i)},removeChild(t,e){t.removeChild(e)},removeChildFromContainer(t,e){t.removeChild(e)},commitTextUpdate(t,e,i){t.update(i)},commitUpdate(t,e,i,r,o){t.update(o)}});var Ne="1.4.2";const je="VIEW",He="TEXT",Ue="LINK",Ve="PAGE",Xe="NOTE",$e="IMAGE",Ye="DOCUMENT",Je=t=>{const i=_e({type:"ROOT"}),r=Ge.createContainer(i);function o(t={}){if(i.document.props.onRender){const e=i.document.getLayoutData();i.document.props.onRender({...t,layoutData:e})}}function s(t){Ge.updateContainer(t,r,null)}return t&&s(t),{isDirty:function(){return i.isDirty},updateContainer:s,toBuffer:function(){return o(),i.render(),i.instance},toBlob:async function(){await i.render();const t=i.instance.pipe(e());return new Promise((e,i)=>{t.on("finish",()=>{try{const r=t.toBlob("application/pdf");o({blob:r}),e(r)}catch(t){i(t)}}),t.on("error",i)})},toString:function(){let t="";return i.render(),new Promise((e,r)=>{try{i.instance.on("data",function(e){t+=e}),i.instance.on("end",function(){o({string:t}),e(t)})}catch(t){r(t)}})}}},qe=function(t){return Je(t).toBuffer()},Ke=function(e,i,r){const o=qe(e),s=t.createWriteStream(i);return o.pipe(s),new Promise((t,e)=>{s.on("finish",()=>{r&&r(o,i),t(o)}),s.on("error",e)})},Ze=t=>{throw new Error(`${t} is a web specific API. Or you're either using this component on Node, or your bundler is not loading react-pdf from the appropiate web build.`)},Qe=()=>{Ze("PDFViewer")},ti=()=>{Ze("PDFDownloadLink")},ei=()=>{Ze("BlobProvider")},ii=Ke;export default{pdf:Je,View:"VIEW",Text:"TEXT",Link:"LINK",Page:"PAGE",Font:zt,Note:"NOTE",Image:"IMAGE",version:"1.4.2",Document:"DOCUMENT",StyleSheet:Q,PDFRenderer:Ge,PDFViewer:Qe,BlobProvider:ei,PDFDownloadLink:ti,createInstance:_e,renderToStream:qe,renderToFile:Ke,render:Ke};export{qe as renderToStream,Ke as renderToFile,Qe as PDFViewer,ti as PDFDownloadLink,ei as BlobProvider,ii as render,Je as pdf,je as View,He as Text,Ue as Link,Ve as Page,zt as Font,Xe as Note,$e as Image,Ne as version,Ye as Document,Q as StyleSheet,Ge as PDFRenderer,_e as createInstance};
//# sourceMappingURL=react-pdf.es.min.js.map
